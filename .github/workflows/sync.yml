name: Sync LibreTV (No Merge)

on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout private repo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Configure Git
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

      - name: Sync Files
        run: |
          # 1. 更改上游地址为 LibreTV
          git remote add upstream https://github.com/daili115/LibreTV.git
          git fetch upstream
          
          # 2. 强制覆盖文件，排除 .github 文件夹
          # 注意：确认上游主分支名，LibreTV 通常是 main
          git checkout upstream/main -- . ':!.github'
          
          # 3. 清理不在上游库中的多余文件，但保留 .github
          git clean -fd -e .github/
          
          # 4. 检查是否有变动并提交
          git add -A
          if ! git diff --cached --exit-code; then
            git commit -m "chore: sync from LibreTV (excluding .github)"
            git push origin main
          else
            echo "Everything is up to date."
          fi
